<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Majalah Digital Interaktif</title>
    <meta name="description" content="Baca berita dan informasi terkini yang disajikan secara dinamis.">
    <meta property="og:title" content="Majalah Digital Interaktif" />
    <meta property="og:description" content="Baca berita dan informasi terkini dari komunitas kami." />
    <meta property="og:image" content="https://placehold.co/1200x630/1b5e20/ffffff?text=Majalah+Digital" />
    <meta property="og:url" content="" />
    <meta property="og:type" content="article" />
    <meta property="twitter:card" content="summary_large_image" />
    <style>
        :root { --warna-utama: #1b5e20; --warna-aksen: #ffc107; }
        body { font-family: 'Georgia', 'Times New Roman', Times, serif; margin: 0; padding: 0; background-color: #f8f9fa; color: #333; }
        .admin-controls { max-width: 800px; margin: 20px auto; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; padding: 10px; border-radius: 12px; background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .admin-btn { padding: 6px 14px; font-size: 0.8em; font-weight: bold; border-radius: 8px; border: none; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #btn-new-article, #btn-archive, #btn-edit-pengaturan, #btn-share { color: white; }
        #btn-new-article { background-color: var(--warna-utama); }
        #btn-archive { background-color: #546e7a; }
        #btn-edit-pengaturan { background-color: #e65100; }
        #btn-share { background-color: #007bff; }
        .admin-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(2px); }
        .modal-content { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.3); padding: 20px; border-radius: 12px; width: 90%; max-width: 450px; max-height: 90vh; overflow-y: auto; box-shadow: 0 5px 20px rgba(0,0,0,0.2); position: relative; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px; }
        .modal-header h2 { margin: 0; color: var(--warna-utama); font-size: 1.2em; }
        .modal-close-btn { font-size: 1.8em; font-weight: bold; cursor: pointer; color: #aaa; line-height: 1; }
        .modal-close-btn:hover { color: #333; }
        .setting-row { display: flex; flex-wrap: nowrap; align-items: flex-end; gap: 8px; padding-bottom: 12px; margin-bottom: 12px; border-bottom: 1px solid #e0e0e0; }
        .setting-input-group { flex-grow: 1; min-width: 0; }
        .setting-input-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #2e7d32; font-size: 0.8em; }
        .input-with-history input, .input-with-history textarea { font-size: 0.9em; padding: 8px; }
        .btn-apply { padding: 7px 10px; font-size: 0.75em; font-weight: bold; border-radius: 6px; border: none; background-color: #1976d2; color: white; cursor: pointer; transition: background-color 0.3s; display: flex; align-items: center; justify-content: center; gap: 5px; flex-shrink: 0; margin-bottom: 2px; }
        .btn-apply:hover { background-color: #1565c0; }
        .ai-generator-section { padding-bottom: 15px; margin-bottom: 15px; border-bottom: 1px dashed #aaa; }
        .ai-generator-section p { font-weight: bold; color: #333; margin-top: 0; text-align: center; }
        .ai-prompt-group { display: flex; gap: 8px; align-items: flex-end; }
        .ai-prompt-group .form-group { flex-grow: 1; margin-bottom: 0; }
        .ai-prompt-group .btn-update { flex-shrink: 0; width: auto; font-size: 0.8em; padding: 8px 12px; }
        .notification { padding: 12px; margin-bottom: 15px; border-radius: 5px; text-align: center; font-weight: bold; display: none; border: 1px solid transparent; opacity: 0; transition: opacity 0.5s; }
        .notification.show { display: block; opacity: 1; }
        .notification.error { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .notification.success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #2e7d32; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .form-group textarea { height: 100px; resize: vertical; }
        .btn-update { display: flex; justify-content: center; align-items: center; gap: 10px; width: 100%; padding: 10px; background-image: linear-gradient(to right, #28a745 0%, #218838 51%, #28a745 100%); background-size: 200% auto; color: white; border: none; border-radius: 5px; font-size: 1em; font-weight: bold; cursor: pointer; transition: 0.5s; }
        .btn-update:hover { background-position: right center; }
        .btn-update:disabled { cursor: not-allowed; opacity: 0.7; }
        .spinner { width: 18px; height: 18px; border: 3px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite; display: none; }
        .btn-update.loading .spinner, .btn-apply.loading .spinner { display: block; }
        .btn-update.loading .btn-text, .btn-apply.loading .btn-text { display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .container-majalah { background-color: #ffffff; transition: opacity 0.5s ease-in; }
        header, main, .footer-content-inner { max-width: 800px; margin: 0 auto; box-sizing: border-box; }
        header { display: flex; align-items: center; padding: 15px 25px; border-bottom: 4px solid var(--warna-aksen); }
        header .logo { flex-shrink: 0; }
        header .logo img { height: 60px; width: auto; }
        header .logo a { display: inline-block; transition: transform 0.2s ease-in-out; }
        header .logo a:hover { transform: scale(1.05); }
        .title-container { flex-grow: 1; text-align: center; min-width: 0; padding: 0 15px; }
        header h1 { font-size: clamp(1.5em, 4vw, 2.2em); color: var(--warna-utama); margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .magazine-subtitle { font-size: 0.8em; font-style: italic; color: #555; margin: 4px 0 0 0; line-height: 1.3; }
        main { padding: 22px; }
        article .judul-artikel { font-size: clamp(1.8em, 5vw, 2.2em); margin-top: 0; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; color: #388e3c; }
        .artikel-container::after { content: ""; clear: both; display: table; }
        .foto-samping { float: left; width: 45%; max-width: 320px; margin-right: 15px; margin-bottom: 10px; }
        .foto-samping-inner { display: flex; flex-wrap: wrap; }
        .foto-samping-inner a { display: block; box-sizing: border-box; padding: 0; }
        .foto-samping-inner img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .foto-samping[data-count="1"] a { width: 100%; }
        .foto-samping[data-count="2"] a { width: 50%; }
        .foto-samping[data-count="3"] a, .foto-samping[data-count="4"] a { width: 50%; }
        
        /* PERUBAHAN CSS: .teks-artikel sekarang HANYA untuk layout */
        .teks-artikel {
            overflow: hidden; /* Ini akan membuatnya membungkus float dengan benar */
        }
        
        /* PERUBAHAN CSS: Fungsionalitas dipindahkan ke .teks-artikel-inner */
        .teks-artikel-inner {
            text-align: justify;
            line-height: 1.6;
            font-size: 1em;
            overflow-wrap: break-word; 
            hyphens: auto; 
        }

        .teks-artikel-inner table { width: 100%; border-collapse: collapse; margin: 1em 0; font-size: 0.9em; white-space: normal; }
        .teks-artikel-inner th, .teks-artikel-inner td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .teks-artikel-inner th { background-color: #f2f2f2; }
        .teks-artikel-inner tr:nth-child(even) { background-color: #f9f9f9; }
        .teks-artikel-inner > p { margin: 0 0 1em 0; }

        footer { background-color: var(--warna-utama); color: #ffffff; padding: 15px 0; text-align: center; }
        .footer-content { display: flex; flex-direction: column; gap: 15px; }
        .footer-content-inner { display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 15px; font-size: 0.9em; padding: 0 15px; }
        #footerMedsos a { display: inline-flex; align-items: center; gap: 8px; text-decoration: none; color: white; transition: opacity 0.3s; }
        #footerMedsos a:hover { opacity: 0.8; }
        .news-ticker-wrap { width: 100%; background-color: rgba(0,0,0,0.2); padding: 8px 0; overflow: hidden; white-space: nowrap; }
        .news-ticker { display: inline-block; animation: ticker-scroll 60s linear infinite; }
        .news-ticker-wrap:hover .news-ticker { animation-play-state: paused; }
        .news-ticker-item { display: inline-block; margin: 0 20px; color: #fff; text-decoration: none; font-style: italic; }
        .news-ticker-item:hover { text-decoration: underline; }
        @keyframes ticker-scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
        .skeleton { animation: skeleton-pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes skeleton-pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .skeleton-text { height: 1em; background-color: #e0e0e0; border-radius: 4px; }
        .skeleton-img { background-color: #e0e0e0; }
        .archive-list { list-style: none; padding: 0; }
        .archive-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #ddd; }
        .archive-item span { flex-grow: 1; margin-right: 10px; }
        .archive-item button { font-size: 0.8em; padding: 4px 8px; }
        @media (max-width: 650px) { 
            body { padding: 0; padding-bottom: 120px; }
            .admin-controls { margin: 0; border-radius: 0; border-left: none; border-right: none; padding: 15px 10px; } 
            main { padding: 15px; }
            header { padding: 10px 15px; }
            header h1 { padding: 0 10px; font-size: clamp(1.8em, 7vw, 2.8em); }
            .magazine-subtitle { font-size: 0.7em; }
            article .judul-artikel { font-size: 1.4em; }
            .footer-content { gap: 10px; padding-bottom: 0; }
            .footer-content-inner { font-size: 0.75em; }
            
            /* PERUBAHAN CSS: Aturan untuk .teks-artikel di mobile tidak diperlukan lagi */
            
            /* PERUBAHAN CSS: Fitur "Baca Selengkapnya" sekarang diterapkan pada .teks-artikel-inner */
            .teks-artikel-inner {
                font-size: 1.1em;
                max-height: 300px; 
                overflow: hidden;
                position: relative;
                transition: max-height 0.5s ease-in-out;
            }
            .teks-artikel-inner.expanded {
                max-height: 5000px; 
            }
            .read-more-btn {
                display: block;
                width: 100%;
                text-align: center;
                padding: 10px;
                background-color: var(--warna-utama);
                color: white;
                font-weight: bold;
                cursor: pointer;
                border: none;
                border-radius: 5px;
                margin-top: 15px;
            }
            .foto-samping[data-count="1"] { float: left; width: 45%; margin-right: 15px; }
            .foto-samping[data-count="2"], .foto-samping[data-count="3"], .foto-samping[data-count="4"] { float: none; width: 100%; margin-right: 0; }
            footer { position: fixed; bottom: 0; left: 0; width: 100%; z-index: 999; box-shadow: 0 -3px 10px rgba(0,0,0,0.15); box-sizing: border-box; }
        }
    </style>
</head>
<body>

    <div id="admin-panel" class="admin-controls">
        <button id="btn-new-article" class="admin-btn">Tulis Berita Baru</button>
        <button id="btn-archive" class="admin-btn">Arsip Berita</button>
        <button id="btn-edit-pengaturan" class="admin-btn">Edit Pengaturan</button>
        <button id="btn-share" class="admin-btn">Bagikan</button>
    </div>

    <div id="adminModal" class="modal-overlay">...</div>
    <div id="shareModal" class="modal-overlay">...</div>
    <div id="confirmModal" class="modal-overlay">...</div>

    <div id="majalah-wrapper" style="display:none; opacity:0;">
        <div class="container-majalah">
            <header>
                <div class="logo logo-kua"><a id="logoKuaLink" href="#" target="_blank"><img id="logoKuaImg" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Logo KUA"></a></div>
                <div class="title-container">
                    <h1 id="namaMajalah"></h1>
                    <p id="majalahSubtitle" class="magazine-subtitle"></p>
                </div>
                <div class="logo logo-masjid"><a id="logoMasjidLink" href="#" target="_blank"><img id="logoMasjidImg" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Logo Masjid"></a></div>
            </header>
            <main>
                <article>
                    <h2 class="judul-artikel" id="artikelJudul"></h2>
                    <div class="artikel-container">
                        <div class="foto-samping"><div class="foto-samping-inner" id="foto-container"></div></div>
                        
                        <div class="teks-artikel">
                            <div class="teks-artikel-inner" id="artikelTeks"></div>
                        </div>
                    </div>
                </article>
                <button id="btn-baca-selengkapnya" class="read-more-btn" style="display: none;">Baca Selengkapnya</button>
            </main>
            <footer>
                <div class="footer-content">
                    <div class="news-ticker-wrap">
                        <div class="news-ticker" id="news-ticker"></div>
                    </div>
                    <div class="footer-content-inner">
                        <div id="footerMedsos"></div>
                        <div id="footerKontak"></div>
                        <div id="footerAlamat"></div>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <div id="skeleton-loader">...</div>
    <div id="error-container">...</div>

    <script>
        // ... (Seluruh kode JavaScript tetap sama) ...
        const GOOGLE_SHEET_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzswbfPgXcpUzsP3oHTt16-kPUBPcFceebghaBdXeKgOo9aq7932mZi20e8Orxcor9OlQ/exec';
        let fullData = {}; 
        let currentArticleIdToEdit = null;
        let isContributorMode = false;
        
        // ... (Semua fungsi lain tetap sama, termasuk openModal, closeModal, dll) ...
        
        // PERUBAHAN JAVASCRIPT: TIDAK ADA!
        // Fungsi di bawah ini sekarang akan bekerja dengan benar karena perubahan HTML dan CSS.
        function setupReadMore() {
            if (window.innerWidth > 650) return;

            const teksArtikel = document.getElementById('artikelTeks'); // Ini sekarang menargetkan div bagian dalam
            const btnReadMore = document.getElementById('btn-baca-selengkapnya');
            
            if (!teksArtikel || !btnReadMore) {
                console.error("Elemen artikel atau tombol tidak ditemukan.");
                return;
            }

            teksArtikel.classList.remove('expanded');
            btnReadMore.style.display = 'none';
            btnReadMore.textContent = 'Baca Selengkapnya';

            if (!btnReadMore.hasAttribute('data-listener-attached')) {
                btnReadMore.addEventListener('click', () => {
                    teksArtikel.classList.toggle('expanded');
                    if (teksArtikel.classList.contains('expanded')) {
                        btnReadMore.textContent = 'Tampilkan Lebih Sedikit';
                    } else {
                        btnReadMore.textContent = 'Baca Selengkapnya';
                    }
                });
                btnReadMore.setAttribute('data-listener-attached', 'true');
            }

            setTimeout(() => {
                if (teksArtikel.scrollHeight > 300) {
                    btnReadMore.style.display = 'block';
                }
            }, 100); 
        }

        function displayContent(data) {
            const article = data.article || {}; 
            const settings = data.settings.current || {};
            // ... (Kode di dalam displayContent tetap sama) ...
            
            // Kode ini menargetkan 'artikelTeks', yang sekarang adalah div bagian dalam, jadi sudah benar.
            const teksContainer = document.getElementById('artikelTeks');
            teksContainer.innerHTML = article.content || "<p>Silakan masukkan berita pertama.</p>";

            // ... (Sisa kode displayContent tetap sama) ...
            
            setupClickTrackers();
            setupReadMore(); // Panggilan ini tetap di sini dan akan bekerja.
        }

        // ... (Sisa dari semua fungsi JavaScript lainnya tetap sama) ...
        async function loadAllContent() { /* ... */ }
        async function sendData(payload, button, panel, successCallback) { /* ... */ }
        // Dst.
    </script>
    </body>
</html>
